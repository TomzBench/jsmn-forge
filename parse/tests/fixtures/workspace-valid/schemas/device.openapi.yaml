openapi: 3.1.0
info:
  title: Device Management
  version: "0"
paths:
  /api/v1/device:
    get:
      operationId: getDevice
      responses:
        "200":
          description: Current device info
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/device_info"
  /api/v1/device/firmware:
    get:
      operationId: getFirmware
      responses:
        "200":
          description: Current firmware info
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/firmware"
    post:
      operationId: uploadFirmware
      requestBody:
        required: true
        content:
          application/json:
            schema:
              x-jsmn-id: firmware_upload
              type: object
              required: [slot, size, crc]
              properties:
                slot:
                  type: integer
                  format: uint8
                size:
                  type: integer
                  format: uint32
                crc:
                  type: integer
                  format: uint32
                flags:
                  type: integer
                  format: uint8
      responses:
        "200":
          description: Upload accepted
  /api/v1/device/reboot:
    post:
      operationId: rebootDevice
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [delay]
              properties:
                delay:
                  type: integer
                  format: uint32
                reason:
                  type: string
                  maxLength: 64
      responses:
        "200":
          description: Reboot scheduled
  /api/v1/device/diagnostics:
    get:
      operationId: getDiagnostics
      responses:
        "200":
          description: Diagnostic snapshot
          content:
            application/json:
              schema:
                type: object
                required: [uptime, memory_free, temperature]
                properties:
                  uptime:
                    type: integer
                    format: uint32
                  memory_free:
                    type: integer
                    format: uint32
                  temperature:
                    type: integer
                    format: int16
                  faults:
                    type: array
                    maxItems: 16
                    items:
                      type: integer
                      format: uint32
components:
  schemas:
    device_info:
      type: object
      required: [name, serial, version]
      properties:
        name:
          type: string
          maxLength: 32
        serial:
          type: string
          maxLength: 16
        version:
          type: integer
          format: uint32
    firmware:
      type: object
      required: [version, size, crc]
      properties:
        version:
          type: integer
          format: uint32
        size:
          type: integer
          format: uint32
        crc:
          type: integer
          format: uint32
